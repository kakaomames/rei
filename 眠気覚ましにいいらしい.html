<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>REBEL WARFARE</title>
    <style>
        body {
            background-color: #111;
            color: #eee;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        h2, h3, p {
            text-align: center;
        }
        
        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #444;
            color: #fff;
            border: 1px solid #666;
            border-radius: 5px;
            transition: background-color 0.1s;
        }
        
        button:hover {
            background-color: #666;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        #gameArea {
            position: relative;
            margin: 20px auto;
            border: 2px solid #333;
            background-color: #000;
        }
        
        #gameCanvas {
            display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
        }

        /* ãƒ›ãƒ¼ãƒ /ã‚¹ãƒˆã‚¢/è¨­å®šç”»é¢ */
        #homeScreen, #storeScreen, #settingsScreen {
            display: block; /* åˆæœŸçŠ¶æ…‹ã¯ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤º */
            max-width: 400px;
            padding: 20px;
            background-color: #222;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 400px;
            padding: 10px 0;
            background-color: #111;
        }

        .controls-group {
            display: flex;
            flex-direction: row;
        }
        
        .controls button {
            padding: 15px 15px;
            font-size: 14px;
        }
        
        /* ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #debugLog {
            position: absolute;
            bottom: 0; /* ç”»é¢ä¸‹éƒ¨ã«å›ºå®š */
            left: 0;
            width: 100%;
            height: 150px; /* é«˜ã•å›ºå®š */
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.7);
            color: #0f0;
            font-family: monospace;
            font-size: 10px;
            padding: 5px;
            box-sizing: border-box;
            white-space: pre-wrap;
            pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚’é€éã•ã›ã‚‹ */
            z-index: 1000;
        }
        
        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #popupMessage {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 8px;
            color: #fff;
            font-weight: bold;
            display: none;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .popup-info { background-color: #007bff; }
        .popup-error { background-color: #dc3545; }
        .popup-success { background-color: #28a745; }
    </style>
</head>
<body>

    <div id="gameArea">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        
        <div id="debugLog"></div>

        <div id="homeScreen">
            <h2>ğŸ›¡ï¸ ãƒã‚¤ã‚¯ãƒ©ãƒ»ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ›ãƒ¼ãƒ  ğŸ¡</h2>
            <p>äººé¡æœ€å¾Œã®æŠµæŠ—</p>
            <hr>
            
            <button onclick="reloadGameDataAndNavigate()" style="padding: 10px 20px; margin: 10px; background-color: #333; color: #fff; border: 1px solid #ff4444;">
                ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            </button>
            <hr>

            <div id="levelSelect">
                <h3>REBELé¸æŠ</h3>
                <p>ãƒ­ãƒ¼ãƒ‰ä¸­...</p>
            </div>
            
            <hr>
            <button onclick="window.location.hash='#store'" style="padding: 10px 20px; margin: 10px;">ğŸ›’ ã‚¹ãƒˆã‚¢</button>
            <button onclick="window.location.hash='#settings'" style="padding: 10px 20px; margin: 10px;">âš™ï¸ è¨­å®š</button>
            <p style="margin-top: 20px; font-size: 12px; color: #888;">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 0.0.1</p>
        </div>
        
        <div id="storeScreen" style="display: none;"></div>
        
        <div id="settingsScreen" style="display: none;"></div>
        
        <div id="popupMessage"></div>
    </div>

    <div class="controls">
        <div class="controls-group">
            <button id="leftButton" ontouchstart="handleInput('left')" ontouchend="handleInput('stopX')">
                â—€ï¸ LEFT
            </button>
            <button id="rightButton" ontouchstart="handleInput('right')" ontouchend="handleInput('stopX')">
                â–¶ï¸ RIGHT
            </button>
        </div>
        
        <div class="controls-group">
            <button id="fireButton">SHOOT</button>
            <button id="shieldButton">SHIELD</button>
            <button id="potionButton">POTION (0)</button>
            </div>
    </div>
    
    <script src="./data/js/state.js"></script>

    <script src="./data/js/player_core.js"></script> 
    
    <script src="./data/js/game.js"></script>
    
    <script src="./data/js/player_input.js"></script> 
    <script src="./data/js/enemy.js"></script>
    <script src="./data/js/collision.js"></script>
    
    <script src="./data/js/ui_draw.js"></script>
    <script src="./data/js/settings.js"></script>
    <script src="./data/js/router.js"></script>
    
    <script>
        /**
         * ãƒ‡ãƒ¼ã‚¿ã‚’å†ãƒ­ãƒ¼ãƒ‰ã—ã€ç¾åœ¨ã®ãƒãƒƒã‚·ãƒ¥ã«å¼·åˆ¶çš„ã«å†é·ç§»ã™ã‚‹
         */
        async function reloadGameDataAndNavigate() {
            // ãƒ­ã‚°é–¢æ•°ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªï¼ˆsettings.jsã«ä¾å­˜ï¼‰
            const logFn = typeof addLog === 'function' ? addLog : console.log;
            
            // game.js / router.js ã®ã‚³ã‚¢æ©Ÿèƒ½ã®å­˜åœ¨ã‚’ç¢ºèª
            if (typeof loadGameData !== 'function' || typeof navigate !== 'function') {
                logFn("è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: game.jsã¾ãŸã¯router.jsãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
                alert("è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼: ã‚²ãƒ¼ãƒ ã®ã‚³ã‚¢æ©Ÿèƒ½ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼");
                return;
            }
            
            logFn("ãƒ‡ãƒ¼ã‚¿ã®å†å–å¾—ã‚’é–‹å§‹ã—ã¾ã™...");

            // UIã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆui_draw.jsã«ä¾å­˜ï¼‰
            if (typeof showPopupMessage === 'function') {
                 showPopupMessage("ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ä¸­ã§ã™...", 2000, 'info');
            }

            try {
                // game.js ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰é–¢æ•°ã‚’å‘¼ã³å‡ºã™
                await loadGameData();
                
                // æˆåŠŸ
                logFn("ãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸï¼ğŸ‰");
                
                // ç¾åœ¨ã®ç”»é¢ã«å†é·ç§»ã—ã¦UIã‚’æ›´æ–°
                navigate(window.location.hash || '#home');
                
                if (typeof showPopupMessage === 'function') {
                    showPopupMessage("ãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸï¼ğŸ‰", 3000, 'info');
                }
                
            } catch (error) {
                // å¤±æ•—
                const errorMessage = `ãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚è©³ç´°: ${error.message}`;
                logFn(`è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: ${errorMessage}`);
                console.error("æ‰‹å‹•ãƒ­ãƒ¼ãƒ‰å¤±æ•—:", error);
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥ï¼ˆalertã¨ç”»é¢ä¸Šã®ä¸¡æ–¹ï¼‰
                alert(errorMessage + " ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                
                if (typeof showPopupMessage === 'function') {
                    showPopupMessage("ãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚", 5000, 'error');
                }
            }
        }
    </script>
</body>
</html>
