<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒœã‚¿ãƒ³æ“ä½œãƒ»ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ </title>
    <style>
        /* ğŸ¨ å…¨ä½“ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            background-color: #222;
            display: flex;
            flex-direction: column; /* ç¸¦ã«ä¸¦ã¹ã‚‹ */
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        /* ğŸ•¹ï¸ ã‚²ãƒ¼ãƒ ç”»é¢ */
        canvas {
            border: 2px solid #fff;
            background-color: #000;
            touch-action: none; /* ã‚¿ãƒƒãƒæ“ä½œæ™‚ã®ãƒ–ãƒ©ã‚¦ã‚¶æ—¢å®šã®å‹•ä½œã‚’ç„¡åŠ¹åŒ– */
        }
        /* ğŸ•¹ï¸ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼éƒ¨åˆ† */
        .controls {
            margin-top: 10px;
            width: 600px; /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã¨åŒã˜å¹…ã«åˆã‚ã›ã‚‹ */
            display: flex;
            justify-content: space-around;
        }
        .control-button {
            padding: 10px 20px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            background-color: #444;
            border: 2px solid #fff;
            border-radius: 8px;
            cursor: pointer;
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’é˜²æ­¢ */
            transition: background-color 0.1s;
            line-height: 1; /* ãƒœã‚¿ãƒ³å†…ã®æ–‡å­—ã®é«˜ã•ã‚’èª¿æ•´ */
        }
        .control-button:active {
            background-color: #777; /* æŠ¼ã—ãŸæ™‚ã®è‰² */
        }
        .move-buttons {
            display: flex;
            gap: 10px;
        }
        #shootButton {
            background-color: #d9534f; /* ç™ºå°„ãƒœã‚¿ãƒ³ã¯ç›®ç«‹ã¤è‰²ã« */
        }
        #shootButton:active {
            background-color: #c9302c;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    
    <div class="controls">
        <div class="move-buttons">
            <div id="leftButton" class="control-button">â¬…ï¸</div>
            <div id="rightButton" class="control-button">â¡ï¸</div>
        </div>
        <div id="shootButton" class="control-button">FIRE</div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- ã‚²ãƒ¼ãƒ å®šæ•° ---
        const WIDTH = canvas.width;
        const HEIGHT = canvas.height;

        // --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆè‡ªæ©Ÿï¼‰ ---
        const player = {
            x: WIDTH / 2 - 20,
            y: HEIGHT - 40,
            width: 40,
            height: 40,
            color: 'cyan',
            speed: 5
        };

        // --- å¼¾ ---
        const bullets = [];
        const bulletSpeed = 7;
        const bulletColor = 'yellow';

        // --- æ•µ ---
        let enemies = [];
        const enemyWidth = 30;
        const enemyHeight = 30;
        let enemySpawnTimer = 0;
        const enemySpawnInterval = 60; // 60ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«æ•µã‚’ç”Ÿæˆ

        // --- ã‚¹ã‚³ã‚¢ ---
        let score = 0;

        // --- ãƒœã‚¿ãƒ³æ“ä½œã®çŠ¶æ…‹ç®¡ç† ---
        const keys = { // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã¨å…±é€šã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨
            ArrowLeft: false,
            ArrowRight: false,
            Space: false
        };

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š (ãƒœã‚¿ãƒ³æ“ä½œ) ---
        
        // 1. å·¦ãƒœã‚¿ãƒ³
        const leftButton = document.getElementById('leftButton');
        leftButton.addEventListener('mousedown', () => { keys.ArrowLeft = true; });
        leftButton.addEventListener('mouseup', () => { keys.ArrowLeft = false; });
        leftButton.addEventListener('touchstart', (e) => { keys.ArrowLeft = true; e.preventDefault(); });
        leftButton.addEventListener('touchend', () => { keys.ArrowLeft = false; });

        // 2. å³ãƒœã‚¿ãƒ³
        const rightButton = document.getElementById('rightButton');
        rightButton.addEventListener('mousedown', () => { keys.ArrowRight = true; });
        rightButton.addEventListener('mouseup', () => { keys.ArrowRight = false; });
        rightButton.addEventListener('touchstart', (e) => { keys.ArrowRight = true; e.preventDefault(); });
        rightButton.addEventListener('touchend', () => { keys.ArrowRight = false; });

        // 3. ç™ºå°„ãƒœã‚¿ãƒ³
        const shootButton = document.getElementById('shootButton');
        shootButton.addEventListener('mousedown', () => { keys.Space = true; });
        shootButton.addEventListener('mouseup', () => { keys.Space = false; });
        shootButton.addEventListener('touchstart', (e) => { keys.Space = true; e.preventDefault(); });
        shootButton.addEventListener('touchend', () => { keys.Space = false; });
        
        // --- æç”»é–¢æ•° ---

        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        function drawBullets() {
            ctx.fillStyle = bulletColor;
            bullets.forEach(b => {
                ctx.fillRect(b.x, b.y, 4, 10);
            });
        }

        function drawEnemies() {
            ctx.fillStyle = 'red';
            enemies.forEach(e => {
                ctx.fillRect(e.x, e.y, enemyWidth, enemyHeight);
            });
        }

        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText('SCORE: ' + score, 10, 30);
        }

        // --- æ›´æ–°é–¢æ•° ---

        function updatePlayer() {
            // ArrowLeftã¾ãŸã¯å·¦ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆ
            if (keys.ArrowLeft && player.x > 0) {
                player.x -= player.speed;
            }
            // ArrowRightã¾ãŸã¯å³ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆ
            if (keys.ArrowRight && player.x < WIDTH - player.width) {
                player.x += player.speed;
            }

            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¾ãŸã¯FIREãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆ
            if (keys.Space) {
                shootBullet();
            }
        }

        // å¼¾ã®ç™ºå°„ï¼ˆé€£å°„å¯èƒ½ï¼‰
        let lastShotTime = 0;
        const shotDelay = 100; // 100ãƒŸãƒªç§’ã”ã¨ã®é€£å°„
        function shootBullet() {
            const currentTime = Date.now();
            if (currentTime - lastShotTime > shotDelay) {
                bullets.push({
                    x: player.x + player.width / 2 - 2,
                    y: player.y,
                    width: 4,
                    height: 10
                });
                lastShotTime = currentTime;
            }
        }

        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].y -= bulletSpeed;

                if (bullets[i].y < 0) {
                    bullets.splice(i, 1);
                }
            }
        }

        function updateEnemies() {
            enemySpawnTimer++;
            if (enemySpawnTimer >= enemySpawnInterval) {
                enemies.push({
                    x: Math.random() * (WIDTH - enemyWidth),
                    y: -enemyHeight,
                    width: enemyWidth,
                    height: enemyHeight,
                    speed: 1 + Math.random() * 2
                });
                enemySpawnTimer = 0;
            }

            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].y += enemies[i].speed;

                if (enemies[i].y > HEIGHT) {
                    enemies.splice(i, 1);
                }
            }
        }

        // --- è¡çªåˆ¤å®š ---
        function checkCollisions() {
            // å¼¾ã¨æ•µã®è¡çª
            for (let i = bullets.length - 1; i >= 0; i--) {
                const b = bullets[i];
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const e = enemies[j];

                    if (b.x < e.x + e.width &&
                        b.x + b.width > e.x &&
                        b.y < e.y + e.height &&
                        b.y + b.height > e.y) {
                        
                        enemies.splice(j, 1);
                        bullets.splice(i, 1); 
                        score += 10;

                        break; 
                    }
                }
            }

            // æ•µã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡çªï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†ï¼‰
            enemies.forEach(e => {
                if (player.x < e.x + e.width &&
                    player.x + player.width > e.x &&
                    player.y < e.y + e.height &&
                    player.y + player.height > e.y) {

                    alert('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ ã‚¹ã‚³ã‚¢: ' + score);
                    resetGame();
                }
            });
        }

        // --- ã‚²ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆ ---
        function resetGame() {
            player.x = WIDTH / 2 - 20;
            player.y = HEIGHT - 40;
            bullets.length = 0;
            enemies.length = 0;
            score = 0;
            enemySpawnTimer = 0;
        }


        // --- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— ---
        function gameLoop() {
            ctx.clearRect(0, 0, WIDTH, HEIGHT);

            updatePlayer();
            updateBullets();
            updateEnemies();
            checkCollisions();

            drawPlayer();
            drawBullets();
            drawEnemies();
            drawScore();

            requestAnimationFrame(gameLoop);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        gameLoop();
    </script>
</body>
</html>
